# Databricks notebook source
# MAGIC %pip install pyyaml

# COMMAND ----------

# MAGIC %run ./dicom_ingestion_library

# COMMAND ----------

from utilities.op_utilities import get_config

# COMMAND ----------

def main():
  """Entry point for ingesting dicom files"""

  config_file_path = dbutils.widgets.get("config_file_path")
  data_from_config = get_config(config_file_path)
  bronze_database = data_from_config["bronze_database"]
  ingestion_details = data_from_config["ingestion_details"]
  bronze_table_name = ingestion_details['destination_table']
  bronze_table = f"{bronze_database}.{bronze_table_name}"

  dicom_dataframe = ingest_dicom_files(data_from_config)

  dicom_dataframe.write.mode("append").format("delta").saveAsTable(bronze_table)
  print("Sucessfully ingest dicom file")


main()
