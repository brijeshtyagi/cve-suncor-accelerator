# Global Configurations
######################################################################
global_settings = {
  # Using Microsoft's Cloud Adoption Framework Naming Standards
  # https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming
  rg_name     = "rg-suncor-test"
  rg_location = "westus2"

  tenant_id = "9ca75128-a244-4596-877b-f24828e476e2"

  tags = {
    Project     = "suncor",
    Environment = "test"
  }

  uai_name = "uai-suncor-test"
}
######################################################################

# Key Vault Configurations
######################################################################
kv_config = {
  name               = "kv-suncor-test"
  default_action     = "Deny"
  allowed_ips        = ["99.253.251.183"]
  allowed_subnet_ids = []
  purge_protection   = false
  access_policies = {
    "SUNCOR-test" = {
      object_id               = "81ea3466-2317-4f63-abad-f32a13793807" # GitHub-Suncor-Team-Test
      secret_permissions      = ["Get", "Set", "Delete", "List", "Recover", "Backup", "Restore", "Purge", ]
      key_permissions         = []
      storage_permissions     = []
      certificate_permissions = []
    }
    "SP-SUNCOR-test" = {
      object_id               = "df707a68-5d90-47bf-999b-a91d634a5317" # GitHub-Suncor-Test (SP Object ID)
      secret_permissions      = ["Get", "Set", "Delete", "List", "Recover", "Backup", "Restore", "Purge", ]
      key_permissions         = []
      storage_permissions     = []
      certificate_permissions = []
    }
  }
}
######################################################################

# Azure Data Factory Configurations
######################################################################
adf_config = {
  name                  = "adf-suncor-test"
  kv_secret_permissions = ["Get", "List"]
  gh_config = {

  }
}
######################################################################

# Azure SQL Configurations
######################################################################
sql_config = {
  sqlinstance = {
    "SQLsuncortest" = {
      sqlservername          = "sqlsuncortest"
      dbname                 = "controldb"
      sql_ad_admin           = "SUNCOR-DBADMIN-test"
      sql_ad_admin_object_id = "3eb7f6db-f6f8-47a2-b754-a8d169b101c7" # GitHub-Suncor-DBAdmin-Test

      sql_firewall_rules = {
        Tarek_IP = "99.253.251.183/32"
      }

      # a valid sku name is 'GP_S_Gen5_1','HS_Gen4_1','BC_Gen5_2', 'ElasticPool', 'Basic', 'S0', 'P1'
      sku_name       = "Basic"
      read_scale     = false
      zone_redundant = false
      max_size_gb    = 2
    }
    "SQLsuncortest2" = {
      sqlservername          = "sqlsuncortest2"
      dbname                 = "sampledata1"
      sql_ad_admin           = "SUNCOR-DBADMIN-test"
      sql_ad_admin_object_id = "3eb7f6db-f6f8-47a2-b754-a8d169b101c7" # GitHub-Suncor-DBAdmin-Test

      sql_firewall_rules = {
        Tarek_IP = "99.253.251.183/32"
      }

      # a valid sku name is 'GP_S_Gen5_1','HS_Gen4_1','BC_Gen5_2', 'ElasticPool', 'Basic', 'S0', 'P1'
      sku_name       = "Basic"
      read_scale     = false
      zone_redundant = false
      max_size_gb    = 2
    }

  }
}
######################################################################

# Storage Account
######################################################################
# Check: CKV_AZURE_43: "Ensure Storage Accounts adhere to the naming rules"
# Guide: https://docs.bridgecrew.io/docs/ensure-storage-accounts-adhere-to-the-naming-rules
# Naming rules:
# 1. Names must be between 3 and 24 characters long
# 2. Names may contain numbers and lowercase letters only
# 3. Storage account name must be unique
sa_config = {
  name                           = "stsuncortest"
  tier                           = "Premium"
  replication_type               = "LRS"
  enabled_hierarchical_namespace = true
  containers = [
    {
      name        = "demo",
      access_type = "private"
    }
  ]
  kind = "BlockBlobStorage"
  network_rules = {
    bypass     = ["AzureServices"]
    ip_rules   = ["99.253.251.183"]
    subnet_ids = []
  }
}
######################################################################

# Synapse
######################################################################
synapse_config = {
  name           = "synsuncortest"
  pool_name      = "suncorsynapsepool"
  azuread_admin  = "SUNCOR-DBADMIN-TEST"
  azuread_app_id = "3eb7f6db-f6f8-47a2-b754-a8d169b101c7" # GitHub-Suncor-DBAdmin-Test

  firewall_rules = {
    Local_IP = "99.253.251.183/32"
  }
}
######################################################################

# Databricks
######################################################################
databricks_config = {
  name                        = "dbw-suncor-test"
  managed_resource_group_name = "rg-suncor-dbw-test"
  sku                         = "premium"
  container_subnet_cidr       = "10.10.20.64/26"
  host_subnet_cidr            = "10.10.20.128/26"
  access_connector_name       = "dbwc-suncor-test"
  metastore_container_name    = "metastore"
}
######################################################################

# Virtual Network
######################################################################
vnet_config = {
  name          = "vnet-suncor-test"
  address_space = ["10.10.20.0/24"]
  subnets = {
    mgt = {
      subnet_name           = "Management"
      subnet_address_prefix = ["10.10.20.0/26"]
    }
  }
}
######################################################################

# Log Analytics Workspace
######################################################################
log_config = {
  name = "log-suncor-test"
}
