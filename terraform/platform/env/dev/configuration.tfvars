# Global Configurations
######################################################################
global_settings = {
  # Using Microsoft's Cloud Adoption Framework Naming Standards
  # https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming
  rg_name     = "rg-suncor-dev"
  rg_location = "westus2"

  tenant_id = "9ca75128-a244-4596-877b-f24828e476e2"

  tags = {
    Project     = "suncor",
    Environment = "dev"
  }

  uai_name = "uai-suncor-dev"
}
######################################################################

# Key Vault Configurations
######################################################################
kv_config = {
  name               = "kv-suncor-dev"
  default_action     = "Deny"
  allowed_ips        = ["99.253.251.183"]
  allowed_subnet_ids = []
  purge_protection   = false
  access_policies = {
    "SUNCOR-DEV" = {
      object_id               = "d8c25139-f390-4008-b954-645a6d71d276" # GitHub-Suncor-Team-Dev
      secret_permissions      = ["Get", "Set", "Delete", "List", "Recover", "Backup", "Restore", "Purge", ]
      key_permissions         = []
      storage_permissions     = []
      certificate_permissions = []
    }
    "SP-SUNCOR-DEV" = {
      object_id               = "aa630c31-f619-4f89-9c55-ab4b085161a7" # GitHub-Suncor-Dev (SP Object ID)
      secret_permissions      = ["Get", "Set", "Delete", "List", "Recover", "Backup", "Restore", "Purge", ]
      key_permissions         = []
      storage_permissions     = []
      certificate_permissions = []
    }
  }
}
######################################################################

# Azure Data Factory Configurations
######################################################################
adf_config = {
  name                  = "adf-suncor-dev"
  kv_secret_permissions = ["Get", "List"]
  gh_config = {
    account_name    = "Slalom-Lab"
    branch_name     = "main"
    git_url         = "https://github.com"
    repository_name = "Suncor-Data-Platform"
    root_folder     = "/adf"
  }
}
######################################################################

# Azure SQL Configurations
######################################################################
sql_config = {
  sqlinstance = {
    "SQLsuncordev" = {
      sqlservername          = "sqlsuncordev"
      dbname                 = "controldb"
      sql_ad_admin           = "SUNCOR-DBADMIN-DEV"
      sql_ad_admin_object_id = "d6311781-e4a6-4492-84ea-6a1800a696e6" # GitHub-Suncor-DBAdmin-Dev

      sql_firewall_rules = {
        Tarek_IP = "99.253.251.183/32"
      }

      # a valid sku name is 'GP_S_Gen5_1','HS_Gen4_1','BC_Gen5_2', 'ElasticPool', 'Basic', 'S0', 'P1'
      sku_name       = "Basic"
      read_scale     = false
      zone_redundant = false
      max_size_gb    = 2
    }
    "SQLsuncordev2" = {
      sqlservername          = "sqlsuncordev2"
      dbname                 = "sampledata1"
      sql_ad_admin           = "SUNCOR-DBADMIN-DEV"
      sql_ad_admin_object_id = "d6311781-e4a6-4492-84ea-6a1800a696e6" # GitHub-Suncor-DBAdmin-Dev

      sql_firewall_rules = {
        Tarek_IP = "99.253.251.183/32"
      }

      # a valid sku name is 'GP_S_Gen5_1','HS_Gen4_1','BC_Gen5_2', 'ElasticPool', 'Basic', 'S0', 'P1'
      sku_name       = "Basic"
      read_scale     = false
      zone_redundant = false
      max_size_gb    = 2
    }

  }
}
######################################################################

# Storage Account
######################################################################
# Check: CKV_AZURE_43: "Ensure Storage Accounts adhere to the naming rules"
# Guide: https://docs.bridgecrew.io/docs/ensure-storage-accounts-adhere-to-the-naming-rules
# Naming rules:
# 1. Names must be between 3 and 24 characters long
# 2. Names may contain numbers and lowercase letters only
# 3. Storage account name must be unique
sa_config = {
  name                           = "stsuncordev"
  tier                           = "Premium"
  replication_type               = "LRS"
  enabled_hierarchical_namespace = true
  containers = [
    {
      name        = "demo",
      access_type = "private"
    }
  ]
  kind = "BlockBlobStorage"
  network_rules = {
    bypass     = ["AzureServices"]
    ip_rules   = ["99.253.251.183"]
    subnet_ids = []
  }
}
######################################################################

# Synapse
######################################################################
synapse_config = {
  name           = "synsuncordev"
  pool_name      = "suncorsynapsepool"
  azuread_admin  = "SUNCOR-DBADMIN-DEV"
  azuread_app_id = "d6311781-e4a6-4492-84ea-6a1800a696e6" # GitHub-Suncor-DBAdmin-Dev

  firewall_rules = {
    Local_IP = "99.253.251.183/32"
  }
}
######################################################################

# Databricks
######################################################################
databricks_config = {
  name                        = "dbw-suncor-dev"
  managed_resource_group_name = "rg-suncor-dbw-dev"
  sku                         = "premium"
  container_subnet_cidr       = "10.10.10.64/26"
  host_subnet_cidr            = "10.10.10.128/26"
  access_connector_name       = "dbwc-suncor-dev"
  metastore_container_name    = "metastore"
}
######################################################################

# Virtual Network
######################################################################
vnet_config = {
  name          = "vnet-suncor-dev"
  address_space = ["10.10.10.0/24"]
  subnets = {
    mgt = {
      subnet_name           = "Management"
      subnet_address_prefix = ["10.10.10.0/26"]
    }
  }
}
######################################################################

# Log Analytics Workspace
######################################################################
log_config = {
  name = "log-suncor-dev"
}
