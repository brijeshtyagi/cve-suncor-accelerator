Param(
    [Parameter(Mandatory=$false)]
    [string]$accessToken,

    [Parameter(Mandatory=$true)]
    [string]$SQLServerName,

    [Parameter(Mandatory=$true)]
    [string]$databaseName
)

if ($accessToken -eq $null)
{
    Write-Output "GETTING TOKEN..."
    $accessToken = (az account get-access-token --resource=https://database.windows.net --query accessToken --output tsv)
    Write-Output "DONE"
}

# Create a SQL connection object
$SqlConnection = New-Object System.Data.SqlClient.SqlConnection
$SqlConnection.ConnectionString = "Server = $SQLServerName; Database = $databaseName;Connect Timeout=30"
$sqlConnection.AccessToken = $($accessToken)

try 
    {
        # Open the SQL connection
        $SqlConnection.Open()

        # Create a SQL command object to query the database
        $SqlCommand = New-Object System.Data.SqlClient.SqlCommand
        $SqlCommand.Connection = $SqlConnection
        $SqlCommand.CommandText = "SELECT COUNT(*) FROM sys.tables"

        # Execute the SQL command and retrieve the count of tables in the database
        $TableCount = $SqlCommand.ExecuteScalar()
    }
finally 
    {
        # Close the SQL connection
        $SqlConnection.Close()
        $SqlCommand.Dispose()
        $SqlConnection.Dispose()
    }

# Check if the table count is zero
if ($TableCount -eq 0) {
    Return $true
} else {
    Return $false
}